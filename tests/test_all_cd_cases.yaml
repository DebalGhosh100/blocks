blocks:
  # Comprehensive test for directory state persistence
  # Testing all corner cases mentioned by the user
  
  # Setup: Create test directory structure
  - run: "mkdir -p test_root"
  - run: "cd test_root"
  
  # Test 1: Simple cd command (baseline)
  - run: "mkdir -p dir1"
  - run: "cd dir1"
  - run: "pwd"  # Should be in test_root/dir1
  
  # Test 2: cd at beginning of compound command (Option 1)
  - run: "mkdir -p subdir"
  - run: "cd subdir && echo 'test' > file.txt"
  - run: "pwd"  # Should be in test_root/dir1/subdir
  - run: "cat file.txt"  # Should show 'test'
  
  # Test 3: cd at end of compound command (tests PWD capture)
  - run: "echo 'another test' > file2.txt && cd .."
  - run: "pwd"  # Should be back in test_root/dir1
  - run: "ls subdir/file2.txt"  # Should exist
  
  # Test 4: Multiple cd commands in one line
  - run: "cd subdir && mkdir -p deep && cd deep"
  - run: "pwd"  # Should be in test_root/dir1/subdir/deep
  
  # Test 5: Relative path from current location (../../)
  - run: "mkdir -p dir2 dir3"
  - run: "cd ../../../../dir2 && echo 'test2' > file.txt"
  - run: "pwd"  # Should be in test_root/dir2
  
  # Test 6: Navigate to sibling directory using relative path
  - run: "cd ../dir3 && echo 'test3' > file.txt"
  - run: "pwd"  # Should be in test_root/dir3
  
  # Test 7: Absolute-like paths with ./
  - run: "cd .."  # Back to test_root
  - run: "pwd"
  - run: "cd ./dir1/subdir && echo 'from root' > fromroot.txt"
  - run: "pwd"  # Should be in test_root/dir1/subdir
  
  # Test 8: Complex compound with cd in middle
  - run: "echo 'before' && cd ../.. && echo 'after' > aftercd.txt"
  - run: "pwd"  # Should be in test_root
  - run: "cat aftercd.txt"
  
  # Test 9: cd followed by cd back in same command
  - run: "cd dir1 && mkdir -p temp && cd temp && echo 'temp' > temp.txt && cd ../.."
  - run: "pwd"  # Should be back in test_root
  
  # Test 10: Verify all files exist where expected
  - run: "ls dir1/subdir/file.txt"
  - run: "ls dir1/subdir/file2.txt"
  - run: "ls dir1/subdir/deep"
  - run: "ls dir2/file.txt"
  - run: "ls dir3/file.txt"
  - run: "ls dir1/temp/temp.txt"
  
  # Cleanup
  - run: "cd .."
  - run: "rm -rf test_root"
  - run: "pwd"  # Should be back to original directory
